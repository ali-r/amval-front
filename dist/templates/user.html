<div class="row">
  <div class="col-md-12 col-sm-12 col-xs-12">
    <div class="x_panel">

      <div class="x_content">
        <form class="filter-form">
          <input type="text" class="form-control search-option" id="firstname" placeholder="نام" ng-model="user.firstNameSearch">
          <input type="text" class="form-control search-option" id="lastname" placeholder="نام خانوادگی" ng-model="user.lastNameSearch">
          <input type="text" class="form-control search-option" id="cardno" placeholder="شماره کارت" ng-model="user.cardNoSearch">
          <select class="form-control filter-option" ng-model="user.sortType">
            <option value="">مرتب سازی بر اساس</option>
            <option value="first_name">نام</option>
            <option value="last_name">نام خانوادگی</option>
            <option value="card_no">نام کاربری</option>
            <option value="phone">شماره تماس</option>
          </select>
          <select class="form-control sort-option" ng-model="user.sortOrder">
            <option value="">صعودی</option>
            <option value="-">  نزولی</option>
          </select>
          <button type="submit" class="btn btn-info filter-btn" ng-click = "user.getFilteredData()">جستجو</button>
        </form>
      </div>
    </div>
  </div>
  <div class="col-md-12 col-sm-12 col-xs-12">
    <div class="x_panel">
      <div class="x_title">
        <h2><i class="fa fa-users"></i> کاربران</h2>
        <button type="button" class="btn btn-success btn-sm pull-left" ng-click="openModal('#userModal')" name="button">کاربر جدید</button>
        <div class="clearfix"></div>
      </div>
      <div class="x_content">
        <table class="table table-striped jambo_table asset-tables">
          <thead>
            <tr>
              <th>#</th>
              <th>نام</th>
              <th>نام خانوادگی</th>
              <th>نام کاربری</th>
              <th>نوع کاربر</th>
              <th>شماره تلفن </th>
              <th></th>
              <th></th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat = "list in user.note">
              <td ng-click="user.getObject(list.id)">{{$index + 1}}</td>
              <td ng-click="user.getObject(list.id)">{{list.first_name}}</td>
              <td ng-click="user.getObject(list.id)">{{list.last_name}}</td>
              <td ng-click="user.getObject(list.id)">{{list.card_no}}</td>
              <td ng-click="user.getObject(list.id)">{{list.clearance_level | userType}}</td>
              <td ng-click="user.getObject(list.id)" style="direction:ltr;">{{list.phone}}</td>
              <td>
                <a ng-click="user.getObject(list.id)" href>
                  <i class="fa fa-lg fa-pencil-square-o" aria-hidden="true"></i>
                </a>
              </td>
              <td>
                <a ng-click = "user.openResetPassModal(list.id)" data-toggle="modal" href>
                  <i class="fa fa-lg fa-key" aria-hidden="true"></i>
                </a>
              </td>
              <td>
                <a ng-click="user.toDeleteId = list.id; user.toDeleteTitle = list.card_no" data-toggle="modal" data-target="#deleteModal" href>
                  <i class="fa fa-lg fa-trash-o" aria-hidden="true"></i>
                </a>
              </td>
            </tr>
          </tbody>
        </table>
        <req-pagination></req-pagination>
      </div>
    </div>
  </div>
</div>

<!-- User Modal -->
<div class="modal fade" id="userModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <div class="pull-left">
          <button type="button" ng-disabled="!userForm.$valid || user.obj.password !== user.confirm_pass"
          ng-click="user.sendOrEdit(editMode)" class="btn btn-success">ذخیره</button>
          <button type="button" class="btn btn-danger" ng-click="reset()" data-dismiss="modal">بستن</button>
        </div>
        <div class="pull-left load-spinner" ng-show = "loadModal">
          <i class="fa fa-spinner fa-pulse fa-2x" ></i>
        </div>
        <h3 class="modal-title" ng-hide="editMode">افزودن کاربر جدید</h3>
        <h3 class="modal-title" ng-show="editMode">ویرایش کاربر</h3>
      </div>
      <div class="modal-body">
        <form name="userForm" role="form" ng-hide="loadModal" novalidate>
          <div class="box-body">
            <div class="row">
              <div class="col-md-4">
                <div class="form-group">
                  <label>نوع کاربر</label>
                  <select class="form-control" ng-model="user.obj.clearance_level" required>
                    <option ng-value="0">کاربر</option>
                    <option ng-value="1">انباردار</option>
                    <option ng-value="2">انباردار مرکزی</option>
                    <option ng-value="3">مدیر</option>
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <label>نام خانوادگی</label>
                  <input type="text" class="form-control" placeholder="نام خانوادگی" ng-model = "user.obj.last_name" required>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <label>نام</label>
                  <input type="text" class="form-control" placeholder="نام" ng-model = "user.obj.first_name" required>
                </div>
              </div>
              <div class="col-md-6" ng-hide="editMode">
                <div class="form-group" ng-class=" {'has-error' : userForm.confPass.$invalid && !userForm.confPass.$pristine,
                  'has-success' : user.confirm_pass === user.obj.password && !userForm.confPass.$pristine}  ">
                  <label>تکرار گذرواژه</label>
                  <input type="password" class="form-control" name="confPass" placeholder="تکرار گذرواژه" ng-model = "user.confirm_pass" ng-required = "!editMode">
                  <p ng-show="user.confirm_pass !== user.obj.password && !userForm.confPass.$pristine" class="input-error-p">با کلمه عبور مطابقت ندارد</p>
                </div>
              </div>
              <div class="col-md-6" ng-hide="editMode">
                <div class="form-group" ng-class=" {'has-error' : userForm.password.$invalid && !userForm.password.$pristine,
                  'has-success' : !userForm.password.$invalid }  ">
                  <label>گذرواژه</label>
                  <input type="password" class="form-control" name="password" placeholder="گذرواژه" ng-pattern = "/[a-z0-9]+/"
                  ng-model = "user.obj.password" ng-required = "!editMode" ng-minlength="8" ng-maxlength="15">
                  <p ng-show="userForm.password.$error.minlength" class="input-error-p">کلمه عبور کوتاه است</p>
                  <p ng-show="userForm.password.$error.maxlength" class="input-error-p">کلمه عبور طولانی است</p>
                  <p ng-show="userForm.password.$error.pattern" class="input-error-p">فقط اعداد و حروف انگلیسی مجاز است</p>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label>شماره کارت (نام کاربری)</label>
                  <input type="text" class="form-control form-ltr" placeholder="شماره کارت" ng-model = "user.obj.card_no" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label>شماره تماس</label>
                  <input type="text" class="form-control form-ltr" placeholder="شماره تماس" ng-model = "user.obj.phone" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label>دسته خدمتی</label>
                  <input type="text" class="form-control" placeholder="دسته خدمتی" ng-model = "user.obj.service_category" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label>وضعیت خدمت</label>
                  <select class="form-control" ng-model = "user.obj.service_situation" required>
                    <option ng-value="0">در حال کار</option>
                    <option ng-value="1">جدا شده</option>
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label>تصویر امضا</label>
                  <br/>
                  <div class="btn btn-info btn-sm" ngf-select="user.uploadPic()" ng-model="user.sigFile" name="file" ngf-pattern="'image/*'"
                    ngf-accept="'image/*'" ngf-max-size="2MB" ng-if="!user.obj.scanned_signature" ng-required="!user.obj.scanned_signature">بارگذاری تصویر امضا</div>
                  <button type="button" class="btn btn-sm btn-danger" ng-if="user.obj.scanned_signature"
                  ng-click=" user.obj.scanned_signature = ''">حذف تصویر</button>
                  <br/>
                  <img class="img-responsive img-thumbnail img-sig" ng-src="{{user.obj.scanned_signature}}"
                  ng-if="user.obj.scanned_signature">
                </div>
              </div>
              <div class="col-md-6" ng-show = "user.obj.clearance_level == 1">
                <div class="form-group">
                  <label>انبار</label>
                  <div class="input-group">
                    <input type="text" class="form-control" ng-model="user.obj.warehouse" ng-required="user.obj.clearance_level == 1" disabled>
                    <span class="input-group-btn">
                      <button type="button" class="btn btn-primary btn-beside-input">انتخاب انبار</button>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
      </form>
      </div>
      <div class="modal-footer">
        <div class="">
          <p ng-show = "uploading">
            <i class="fa fa-refresh fa-spin fa-lg"></i>
            در حال  بارگذاری ...
          </p>
        </div>
        <div class="progress active" ng-hide = "uploadPercentage === 0">
          <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar"
          aria-valuemin="0" id="uploadPercentBox" aria-valuemax="100" ng-style="{ 'width' : uploadPercentage }">
          {{uploadPercentage}}
          </div>
        </div>
        <!--
        <ul>
          <li ng-repeat="(key, errors) in userForm.$error track by $index"> <strong>{{ key }}</strong> errors
            <ul>
              <li ng-repeat="e in errors">{{ e.$name }} has an error: <strong>{{ key }}</strong>.</li>
            </ul>
          </li>
        </ul>
      -->
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="pull-left close" data-dismiss="modal" aria-label="Close" ng-hide ="loadModal">
          <span aria-hidden="true">&times;</span>
        </button>
        <div class="pull-left load-spinner" ng-show = "loadModal">
          <i class="fa fa-spinner fa-pulse fa-2x" ></i>
        </div>
        <h4 class="modal-title" id="myModalLabel" ng-hide = "editMode">حذف کاربر</h4>
      </div>
      <div class="modal-body">
        آیا مایل به حذف کاربر
        "{{user.toDeleteTitle}}"
        هستید؟
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">خیر</button>
        <button type="button" class="btn btn-success" ng-click="user.deleteObject(user.toDeleteId)">بله</button>
      </div>
    </div>
  </div>
</div>

<!-- reset pass Modal -->
<div class="modal fade" id="resetPassModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="pull-left close" data-dismiss="modal" aria-label="Close" ng-hide ="loadModal">
          <span aria-hidden="true">&times;</span>
        </button>
        <div class="pull-left load-spinner" ng-show = "loadModal">
          <i class="fa fa-spinner fa-pulse fa-2x" ></i>
        </div>
        <h4 class="modal-title" id="myModalLabel" ng-hide = "editMode">تغییر کلمه عبور کاربر</h4>
      </div>
      <div class="modal-body">
        <form name="resetPassForm" novalidate>
          <div class="form-group" ng-class="{ 'has-error' : resetPassForm.pass.$invalid && !resetPassForm.pass.$pristine }">
            <label for="pass">کلمه عبور جدید</label>
            <input type="password" class="form-control form-ltr" name="pass" ng-pattern = "/^[a-z0-9]{8,15}$/"
            ng-minlength="8" ng-maxlength="15" ng-model="user.passToReset" required>
            <p ng-show="resetPassForm.pass.$error.minlength" class="input-error-p">کلمه عبور کوتاه است</p>
            <p ng-show="resetPassForm.pass.$error.maxlength" class="input-error-p">کلمه عبور طولانی است</p>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">بستن</button>
        <button type="button" class="btn btn-success" ng-disabled="resetPassForm.$invalid" ng-click="user.resetPass(user.toResetPassId)">ذخیره</button>
      </div>
    </div>
  </div>
</div>
